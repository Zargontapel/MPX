<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PMOS Programmers Manual: src/mpx_r4.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>src/mpx_r4.h File Reference</h1>  </div>
</div>
<div class="contents">

<p><a href="mpx__r4_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mpx__r4_8h.html#a794e5f6c45d4d9b18fff6a530ce90f86">loadProgram</a> (int argc, char *argv[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mpx__r4_8h.html#aaa714b85ce262f949d018430daf6da00">terminateProcess</a> (int argc, char *argv[])</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a794e5f6c45d4d9b18fff6a530ce90f86"></a><!-- doxytag: member="mpx_r4.h::loadProgram" ref="a794e5f6c45d4d9b18fff6a530ce90f86" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loadProgram </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mpx__r4_8c_source.html#l00036">36</a> of file <a class="el" href="mpx__r4_8c_source.html">mpx_r4.c</a>.</p>

<p><div class="fragment"><pre class="fragment">                                        { <span class="comment">//name,fileName,priority,path</span>
        
        <span class="comment">// sets up variables</span>
        <span class="keyword">static</span> <span class="keywordtype">int</span> count;
        <a class="code" href="structmem.html">MEMDSC</a> *tempMem;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> temptop;
        <span class="keywordtype">char</span> *dir, *name, *filename;
        <span class="keywordtype">int</span> size,offset,priority;
        <a class="code" href="structcontext.html">tcontext</a> *tempContext;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *tempCS,*tempIP;
        <a class="code" href="structstack.html">STACKDSC</a> *temp;
        
        <span class="comment">// initializes values</span>
        <span class="keywordtype">int</span> err = 0;
        <a class="code" href="structprocess.html">PCB</a> *newPCB = <a class="code" href="mpx__r2_8c.html#a58a8a1ea0a96b9ecf0be29179a5a0a1e" title="Allocates the memory for a new Process Control Block and returns the pointer to the new PCB location ...">allocate_PCB</a>();
        tempMem=newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>;
        dir = (<span class="keywordtype">char</span>*) sys_alloc_mem(30 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
        name = (<span class="keywordtype">char</span>*) sys_alloc_mem(30 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
        filename = (<span class="keywordtype">char</span>*) sys_alloc_mem(30 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
        strcpy(dir,argv[4]);
        strcpy(name,argv[1]);
        strcpy(filename,argv[2]);
        priority = atoi(argv[3]);
        
        err = sys_check_program(dir,filename,&amp;size,&amp;offset); 
        
        <span class="keywordflow">if</span>((argc==5)||(127&lt;=priority&lt;=-128)&amp;&amp;( err==0)){ <span class="comment">//checks for validity</span>
                
                

              <span class="comment">/*        if( count == ZERO ){ //If first process allocate queue</span>
<span class="comment">                        rQueue = (ROOT*) sys_alloc_mem(sizeof(ROOT));</span>
<span class="comment">                        wsQueue = (ROOT*) sys_alloc_mem(sizeof(ROOT));</span>
<span class="comment">                }   */</span>

                <a class="code" href="mpx__r2_8c.html#a316c9619aba53c03c17afbc0a0dbf096" title="This Function initializes the contents of a PCB and checks the values if correct returns 0 if not ret...">setup_PCB</a>(newPCB,name,<a class="code" href="mpx__r2_8h.html#a796bd7c6ba2e59281760fb155c6287e8" title="is defined as 0">APPLICATION</a>,<a class="code" href="mpx__r2_8h.html#a07b1141143e8825b04670da23fca8cc7" title="is defined by 3">SUSPENDED_READY</a>,priority);


                <span class="comment">// sets up the adressess</span>
                newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a>= sys_alloc_mem(size);
                newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>=newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a> + offset;<span class="comment">// is this the correct address? </span>

                
                newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a>= sys_alloc_mem(size);;
                newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>=newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a> + offset;

                
                <span class="comment">//make sure all registers are properly set</span>
                
                newPCB -&gt; stackdsc-&gt; top = newPCB -&gt; stackdsc-&gt; base + <a class="code" href="mpx__r2_8h.html#a21d9543c516fffee84a7963224271f95" title="is the size of the stack in Bytes">STACKSIZE</a> - <span class="keyword">sizeof</span>(<a class="code" href="structcontext.html">tcontext</a>);
                
                tempContext = (<a class="code" href="structcontext.html">tcontext</a> *) (newPCB -&gt; stackdsc-&gt; top);
                tempContext -&gt;<a class="code" href="structcontext.html#a81a78fef7bda3a5dd852b28a905890ab">ES</a> = _ES;
                tempContext -&gt;DS = _DS;
                tempContext -&gt;CS = FP_SEG(newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>);
                tempContext -&gt;IP = FP_OFF(newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>);
                tempContext -&gt;FLAGS = 0x200;
                
                <span class="comment">// load the program into memory</span>
                 err = sys_load_program(newPCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a>,size,dir,filename);
                
                <a class="code" href="mpx__r2_8c.html#aa3b334e3a5afd6e590917667ad359a6f" title="This function inserts a PCB into its aproprate PCB Queue.">insert_PCB</a>(newPCB);     <span class="comment">// put pcb into a queue</span>
                count++;<span class="comment">//Update the number of times the function has run.</span>
                
        }
        <span class="keywordflow">else</span>{
                printf(<span class="stringliteral">&quot;Wrong or invalid arguments entered.&quot;</span>);
        }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa714b85ce262f949d018430daf6da00"></a><!-- doxytag: member="mpx_r4.h::terminateProcess" ref="aaa714b85ce262f949d018430daf6da00" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminateProcess </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mpx__r4_8c_source.html#l00107">107</a> of file <a class="el" href="mpx__r4_8c_source.html">mpx_r4.c</a>.</p>

<p><div class="fragment"><pre class="fragment">                                             {

        <span class="keywordflow">if</span> (argc == 2){ <span class="comment">// checks for args then searches for process</span>
                <span class="keywordtype">char</span> name[STRLEN];
                <a class="code" href="structprocess.html">PCB</a> *pointer;
                strcpy(name,argv[1]);
                pointer = <a class="code" href="mpx__r2_8c.html#a612a6abcb66c688a32f33abc93ff3990" title="This function findes a PCB by its identifier (name) and returns a pointer to its structures location...">find_PCB</a>(name);
        
                <span class="keywordflow">if</span> ( pointer != NULL){
                        <a class="code" href="mpx__r2_8c.html#af30a3658210d449b4b53e5be2ed2bc2e" title="This function removes a pcb and dealocates its resouces takes in a pointer to a PCBs location...">remove_PCB</a>(pointer);
                        <a class="code" href="mpx__r2_8c.html#a79890f055b1d0fccf1962bbde4877caa" title="This function releases all allocated memory related to a PCB.">free_PCB</a>(pointer);
                }
        }
        
        <span class="keywordflow">else</span>{
                printf(<span class="stringliteral">&quot;Wrong arguments entered.&quot;</span>);
                <span class="keywordflow">return</span>;
        }
}
</pre></div></p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 10 2010 01:08:39 for PMOS Programmers Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
