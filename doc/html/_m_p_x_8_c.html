<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PMOS Programmers Manual: src/MPX.C File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>src/MPX.C File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;dos.h&gt;</code><br/>
<code>#include &quot;mpx_supt.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="mpx__util_8h_source.html">mpx_util.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mpx__cmd_8h_source.html">mpx_cmd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mpx__r4_8h_source.html">mpx_r4.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_m_p_x___r3_8_h_source.html">mpx_r3.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mpx__r2_8h_source.html">mpx_r2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_m_p_x___r5_8h_source.html">mpx_r5.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="trmdrive_8h_source.html">TRMDRIVE.H</a>&quot;</code><br/>

<p><a href="_m_p_x_8_c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_m_p_x_8_c.html#acdef7a1fd863a6d3770c1268cb06add3">main</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Entry Point of MPX.  <a href="#acdef7a1fd863a6d3770c1268cb06add3"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acdef7a1fd863a6d3770c1268cb06add3"></a><!-- doxytag: member="MPX.C::main" ref="acdef7a1fd863a6d3770c1268cb06add3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void main </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Entry Point of MPX. </p>
<p>This is the entry point of MPX, it calls the mpx_command_loop. The Command Loop function starts the display of the Welcome Message and the inital home screen of MPX. </p>

<p>Definition at line <a class="el" href="_m_p_x_8_c_source.html#l00038">38</a> of file <a class="el" href="_m_p_x_8_c_source.html">MPX.C</a>.</p>

<p><div class="fragment"><pre class="fragment">           {
        <span class="keywordtype">int</span> err;
        <a class="code" href="structprocess.html">PCB</a> *command_loop, *idlePCB;
        <a class="code" href="structstack.html">STACKDSC</a> *command_stack;
        <a class="code" href="structcontext.html">tcontext</a> *command_context;
        <a class="code" href="structcontext.html">tcontext</a> *tempContext;
        <span class="keywordtype">char</span> dir[20] = <span class="stringliteral">&quot;proc&quot;</span>;
        <span class="keywordtype">char</span> name[20] = <span class="stringliteral">&quot;idle&quot;</span>;
        <span class="keywordtype">char</span> filename[20] = <span class="stringliteral">&quot;IDLE&quot;</span>;
        <span class="keywordtype">int</span> sizex,offset,priority;
        <span class="keywordtype">int</span> eventFlag, eventtFlag;
        <span class="keywordtype">char</span> command[20] = <span class="stringliteral">&quot;Command_Hand&quot;</span>;
        sys_init( MODULE_R4 ); <span class="comment">//System initilization</span>
        sys_set_vec(<a class="code" href="mpx__r3_8c.html#abeb8ddb92acb8fa40e902b98f2a1ccfb">sys_call</a>);

        <span class="comment">//Open Device Drivers</span>
        <span class="comment">//com_open( (int *) eventFlag, 1200);</span>
       <span class="comment">//trm_open(  (int *) eventtFlag );</span>

        <span class="comment">// Command Handler loop insertion</span>
        command_loop = <a class="code" href="mpx__r2_8c.html#a58a8a1ea0a96b9ecf0be29179a5a0a1e" title="Allocates the memory for a new Process Control Block and returns the pointer to the new PCB location ...">allocate_PCB</a>();

        command_stack = command_loop -&gt; stackdsc;

        command_stack-&gt;<a class="code" href="structstack.html#adf145fa22a24464ff19409e2618a583d" title="pointer to the top of the stack">top</a> = command_stack-&gt;<a class="code" href="structstack.html#a1cdb71e486a79747d482aa46f6b10290" title="pointer to the bottom of the stack">base</a> + <a class="code" href="mpx__r2_8h.html#a21d9543c516fffee84a7963224271f95" title="is the size of the stack in Bytes">STACKSIZE</a> - <span class="keyword">sizeof</span>(<a class="code" href="structcontext.html">tcontext</a>);

        command_context = (<a class="code" href="structcontext.html">tcontext</a>*) command_stack-&gt;<a class="code" href="structstack.html#adf145fa22a24464ff19409e2618a583d" title="pointer to the top of the stack">top</a>;

        command_context-&gt;DS = _DS;
        command_context-&gt;ES = _ES;
        command_context-&gt;CS = FP_SEG(&amp;<a class="code" href="_m_p_x___c_m_d_8_c.html#ab2f64c5ce0432edca230a87739501703" title="This function displays the Main Screen for mpx.">mpx_command_loop</a>);
        command_context-&gt;IP = FP_OFF(&amp;<a class="code" href="_m_p_x___c_m_d_8_c.html#ab2f64c5ce0432edca230a87739501703" title="This function displays the Main Screen for mpx.">mpx_command_loop</a>);
        command_context-&gt;FLAGS = 0x200;

        <a class="code" href="mpx__r2_8c.html#a316c9619aba53c03c17afbc0a0dbf096" title="This Function initializes the contents of a PCB and checks the values if correct returns 0 if not ret...">setup_PCB</a>(command_loop,command,<a class="code" href="mpx__r2_8h.html#a21b97df85e65556468b28a576311271c" title="is defined as 1">SYSTEM</a>,<a class="code" href="mpx__r2_8h.html#ad1235d5ce36f7267285e82dccd428aa6" title="state is Defined as 1">READY</a>,-127);

        <a class="code" href="mpx__r2_8c.html#aa3b334e3a5afd6e590917667ad359a6f" title="This function inserts a PCB into its aproprate PCB Queue.">insert_PCB</a>(command_loop);

        <span class="comment">//IDLE Process insertion</span>

        sys_check_program(dir,filename,&amp;sizex,&amp;offset);

        idlePCB = <a class="code" href="mpx__r2_8c.html#a58a8a1ea0a96b9ecf0be29179a5a0a1e" title="Allocates the memory for a new Process Control Block and returns the pointer to the new PCB location ...">allocate_PCB</a>();
        <a class="code" href="mpx__r2_8c.html#a316c9619aba53c03c17afbc0a0dbf096" title="This Function initializes the contents of a PCB and checks the values if correct returns 0 if not ret...">setup_PCB</a>(idlePCB,name,<a class="code" href="mpx__r2_8h.html#a796bd7c6ba2e59281760fb155c6287e8" title="is defined as 0">APPLICATION</a>,<a class="code" href="mpx__r2_8h.html#ad1235d5ce36f7267285e82dccd428aa6" title="state is Defined as 1">READY</a>,127);

        idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a> = sys_alloc_mem(sizex);
        idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a> = idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a> + offset;

        idlePCB-&gt;<a class="code" href="structprocess.html#a7e0fb37fbb9c155b18f75a94a8fc202b" title="stores the description of the stack for each process;">stackdsc</a>-&gt;<a class="code" href="structstack.html#adf145fa22a24464ff19409e2618a583d" title="pointer to the top of the stack">top</a> = idlePCB-&gt;<a class="code" href="structprocess.html#a7e0fb37fbb9c155b18f75a94a8fc202b" title="stores the description of the stack for each process;">stackdsc</a>-&gt;<a class="code" href="structstack.html#a1cdb71e486a79747d482aa46f6b10290" title="pointer to the bottom of the stack">base</a> + <a class="code" href="mpx__r2_8h.html#a21d9543c516fffee84a7963224271f95" title="is the size of the stack in Bytes">STACKSIZE</a> - <span class="keyword">sizeof</span>(<a class="code" href="structcontext.html">tcontext</a>);

        tempContext = (<a class="code" href="structcontext.html">tcontext</a> *) (idlePCB-&gt;<a class="code" href="structprocess.html#a7e0fb37fbb9c155b18f75a94a8fc202b" title="stores the description of the stack for each process;">stackdsc</a>-&gt;<a class="code" href="structstack.html#adf145fa22a24464ff19409e2618a583d" title="pointer to the top of the stack">top</a>);
        tempContext-&gt;<a class="code" href="structcontext.html#a81a78fef7bda3a5dd852b28a905890ab">ES</a> = _ES;
        tempContext-&gt;DS = _DS;
        tempContext-&gt;CS = FP_SEG(idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>);
        tempContext-&gt;IP = FP_OFF(idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a5340491e17307817e6dca3b1d260d18a" title="Address of first INSTRUCTION.">execADDR</a>);
        tempContext-&gt;FLAGS = 0x200;

        sys_load_program(idlePCB-&gt;<a class="code" href="structprocess.html#a163551ab7b60184b48e5d440fcd5c2b8" title="stores the description of the ADDRESS SPACE for the process">memdsc</a>-&gt;<a class="code" href="structmem.html#a8f5a4db03ee0560e6bd4dd602ad753c0" title="Address to load data to.">loadADDR</a>,sizex,dir,filename);

        <a class="code" href="mpx__r2_8c.html#aa3b334e3a5afd6e590917667ad359a6f" title="This function inserts a PCB into its aproprate PCB Queue.">insert_PCB</a>(idlePCB);


        <a class="code" href="mpx__r3_8c.html#ad4150c832feb766384417ab7bae70089">dispatch</a>();
        printf(<span class="stringliteral">&quot;exit sucess&quot;</span>);
        <span class="comment">//mpxprompt_anykey();</span>
        sys_exit();
}
</pre></div></p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 10 2010 01:08:39 for PMOS Programmers Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
